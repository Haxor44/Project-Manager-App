<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Home</title>
	<link rel="stylesheet" type="text/css" href="./styles/home.css">
</head>
<body>
	<div class="wrapper">
		<header>
			<a href="#" class="customer">Customer</a>
			<nav>
				<ul class="links">
				<li><a href="#" class="navs">Home</a></li>
				<li><a href="upload.html" class="navs">Upload</a></li>
				<li><a href="chat.html" class="navs">Chat</a></li>
				<li><a href="" id="logout" class="navs">Logout</a></li>
				</ul>
			</nav>
		</header>

	

		<section class="content">
			<h1>Overview</h1>
			<div class="card1">
	<div class="card-wrapper">
<div class="card">
	<svg class="p2" width="60" height="46" viewBox="0 0 46 40" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M40.5 4.66667H30.05C29.5381 3.54626 28.5847 2.5755 27.3217 1.88869C26.0587 1.20187 24.5485 0.832947 23 0.832947C21.4515 0.832947 19.9413 1.20187 18.6783 1.88869C17.4153 2.5755 16.4619 3.54626 15.95 4.66667H5.5C4.17513 4.6697 2.90566 5.07454 1.96884 5.79278C1.03201 6.51101 0.503957 7.48427 0.5 8.5L0.5 35.3333C0.503957 36.3491 1.03201 37.3223 1.96884 38.0406C2.90566 38.7588 4.17513 39.1636 5.5 39.1667H40.5C41.8249 39.1636 43.0943 38.7588 44.0312 38.0406C44.968 37.3223 45.496 36.3491 45.5 35.3333V8.5C45.496 7.48427 44.968 6.51101 44.0312 5.79278C43.0943 5.07454 41.8249 4.6697 40.5 4.66667V4.66667ZM23 4.66667C23.4945 4.66667 23.9778 4.77908 24.3889 4.98968C24.8 5.20029 25.1205 5.49963 25.3097 5.84986C25.4989 6.20008 25.5484 6.58546 25.452 6.95726C25.3555 7.32905 25.1174 7.67057 24.7678 7.93862C24.4181 8.20667 23.9727 8.38922 23.4877 8.46317C23.0028 8.53713 22.5001 8.49917 22.0433 8.3541C21.5865 8.20904 21.196 7.96337 20.9213 7.64818C20.6466 7.33298 20.5 6.96242 20.5 6.58333C20.502 6.07547 20.766 5.58884 21.2344 5.22972C21.7028 4.87061 22.3376 4.66818 23 4.66667V4.66667ZM18 14.25L24.975 19.6052L31.275 14.7752L28 12.3333H38V20L34.81 17.4873L24.98 25.0293L18 19.6742L11.535 24.6268L8 21.9167L18 14.25ZM40.5 33.4167H5.5V29.5833H40.5V33.4167Z" fill="#8746F0"></path>
</svg>

	<h5>Projects Completed</h5>
	<span class="badge">2</span>
	</div>

	<div class="card">
		<svg width="64" height="46" viewBox="0 0 61 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M51.8504 16.8V23.04C48.693 21.7708 45.1057 21.3214 41.6035 21.7564C38.1014 22.1914 34.8644 23.4884 32.3573 25.4612C29.8502 27.434 28.202 29.9811 27.6492 32.7369C27.0964 35.4927 27.6674 38.3155 29.2804 40.8H16.7754C14.7531 40.8 12.8137 40.1679 11.3837 39.0426C9.95374 37.9174 9.15039 36.3913 9.15039 34.8V16.8H51.8504ZM44.2254 7.2C46.2477 7.2 48.1871 7.83214 49.6171 8.95736C51.047 10.0826 51.8504 11.6087 51.8504 13.2V14.4H9.15039V13.2C9.15039 11.6087 9.95374 10.0826 11.3837 8.95736C12.8137 7.83214 14.7531 7.2 16.7754 7.2H44.2254ZM42.3191 30C42.3191 29.6022 42.52 29.2206 42.8775 28.9393C43.235 28.658 43.7198 28.5 44.2254 28.5C44.731 28.5 45.2158 28.658 45.5733 28.9393C45.9308 29.2206 46.1316 29.6022 46.1316 30C46.1316 30.3978 45.9308 30.7794 45.5733 31.0607C45.2158 31.342 44.731 31.5 44.2254 31.5C43.7198 31.5 43.235 31.342 42.8775 31.0607C42.52 30.7794 42.3191 30.3978 42.3191 30V30ZM45.7504 39.6C45.7504 39.9183 45.5897 40.2235 45.3037 40.4485C45.0177 40.6736 44.6298 40.8 44.2254 40.8C43.8209 40.8 43.433 40.6736 43.1471 40.4485C42.8611 40.2235 42.7004 39.9183 42.7004 39.6V34.8C42.7004 34.4817 42.8611 34.1765 43.1471 33.9515C43.433 33.7264 43.8209 33.6 44.2254 33.6C44.6298 33.6 45.0177 33.7264 45.3037 33.9515C45.5897 34.1765 45.7504 34.4817 45.7504 34.8V39.6ZM30.5004 34.8C30.5004 31.9357 31.9464 29.1886 34.5204 27.1632C37.0943 25.1379 40.5853 24 44.2254 24C47.8655 24 51.3565 25.1379 53.9304 27.1632C56.5044 29.1886 57.9504 31.9357 57.9504 34.8C57.9504 37.6643 56.5044 40.4114 53.9304 42.4368C51.3565 44.4621 47.8655 45.6 44.2254 45.6C40.5853 45.6 37.0943 44.4621 34.5204 42.4368C31.9464 40.4114 30.5004 37.6643 30.5004 34.8V34.8ZM33.5504 34.8C33.5504 35.9031 33.8265 36.9954 34.363 38.0145C34.8994 39.0337 35.6858 39.9597 36.677 40.7397C37.6683 41.5197 38.8451 42.1384 40.1402 42.5606C41.4354 42.9827 42.8235 43.2 44.2254 43.2C45.6273 43.2 47.0154 42.9827 48.3105 42.5606C49.6057 42.1384 50.7825 41.5197 51.7738 40.7397C52.765 39.9597 53.5513 39.0337 54.0878 38.0145C54.6243 36.9954 54.9004 35.9031 54.9004 34.8C54.9004 32.5722 53.7757 30.4356 51.7738 28.8603C49.7718 27.285 47.0566 26.4 44.2254 26.4C41.3942 26.4 38.679 27.285 36.677 28.8603C34.6751 30.4356 33.5504 32.5722 33.5504 34.8V34.8Z" fill="#8746F0"></path>
</svg>

	<h5>Info</h5> 
	
	</div>

	<div class="card">
		<svg class="p2" width="60" height="46" viewBox="0 0 69 46" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M31.6252 3.89084V7.76251C19.0039 8.79751 10.0627 16.445 11.6152 24.8592C12.9377 31.8358 21.1602 37.375 31.6252 38.1992V42.0325C15.8127 40.9783 4.31269 31.625 5.89394 21.0833C7.18769 11.9792 18.0264 4.79167 31.6252 3.89084M37.3752 3.94834C42.9814 4.31251 48.3289 5.75001 52.6989 8.16501L48.5877 11.0017C45.3677 9.27667 41.4864 8.16501 37.3752 7.78167V3.94834M56.7527 10.8675C60.3474 13.7757 62.5596 17.3326 63.1064 21.0833H57.3564C56.8102 18.3617 55.2002 15.7742 52.6414 13.6083L56.7527 10.8675ZM24.4377 16.2917L38.4677 25.645L44.5627 21.5817L47.6102 23.6133L38.4677 29.7083L21.3902 18.3233L24.4377 16.2917ZM63.0777 24.9167C62.5027 28.6733 60.2889 32.2192 56.7239 35.1325L52.6414 32.3917C55.1803 30.2251 56.7988 27.6433 57.3277 24.9167H63.0777M48.5877 35.2092L52.6989 37.835C48.344 40.2552 43.0123 41.7623 37.3752 42.1667V38.3333C41.4652 37.9808 45.3378 36.9017 48.5877 35.2092V35.2092Z" fill="#8746F0"></path>
</svg>

	<h5>Progress</h5> 
	<span class="badge">2</span>
	</div>
		</div>
	
	
</div>
	
	<div>
		<h3>My  Projects</h3>
		<button id="cookie">Get Projects</button>
		<div>
			<table border="3">
				<thead>

					<tr>
						<th>Projects</th>
					</tr>	
				</thead>
				<tbody id="tbodys1">
				
				</tbody>
				
			</table>
			
			<h3>Team Members</h3>
			<table border="3">
				<thead>

					<tr>
						<th>User</th>
						<th>Message</th>
						<th>User</th>
						<th>Message</th>
					</tr>	
				</thead>
				<tbody id="tbodys2">
				
				</tbody>
				
			</table>
		</div>
	</div>
			
		</section>
	</div>

	

<script type="module">
	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
  import { getFirestore, collection, doc,  getDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js";
  
  const firebaseConfig = {
    apiKey: "AIzaSyD_qM2MMQWTfJnmuOorriDXaSl9bG1g4Hw",
    authDomain: "manager-app-8904a.firebaseapp.com",
    databaseURL: "https://manager-app-8904a-default-rtdb.firebaseio.com",
    projectId: "manager-app-8904a",
    storageBucket: "manager-app-8904a.appspot.com",
    messagingSenderId: "656541277241",
    appId: "1:656541277241:web:268b3fab190ddd4ed7c1e8",
    measurementId: "G-V68J8LR2EC"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);


   var cookie = document.getElementById('cookie');
   var projects = document.getElementById('projects');
   var tbodys1 = document.getElementById('tbodys1');
   var tbodys2 = document.getElementById('tbodys2');

	function ReadCookie() {
               var allcookies = document.cookie;
               //console.log("All Cookies : " + allcookies );
               
               // Get all the cookies pairs in an array
               var cookiearray = allcookies.split(';');
               
               // Now take key value pair out of this array
               for(var i=0; i<cookiearray.length; i++) {
                  var name = cookiearray[i].split('=')[0];
                  var value = cookiearray[i].split('=')[1];
                  //console.log("Key is : " + name + " and Value is : " + value);
               }
               return value;
            }



//console.log(cookie);
//Get  User Team
async function GetUserInfo() {
	// body...
	var email = ReadCookie();
	//console.log(email);
	var name = "";
	var team;
	const q = query(collection(db, "Users"), where("Email", "==", email));
	const querySnapshot = await getDocs(q);
	querySnapshot.forEach((doc) => {
  // doc.data() is never undefined for query doc snapshots
  	name=doc.id;
  	//console.log(name);
});
GetTeam(name);
sessionStorage.setItem("Loggedin",name);

}
async function GetTeam(user) {
	const q1 = query(collection(db, "Team"));
	const querySnapshot2 = await getDocs(q1);
	querySnapshot2.forEach((docs) => {
  // doc.data() is never undefined for query doc snapshots
  	if(docs.data().Members.includes(user)){
  		console.log(docs.id);
  		GetUserTeamProject(docs.id);
  		let tr = document.createElement('tr');
			let td;
			let button;
		

	  		docs.data().Members.forEach((data)=>{
	  		td = document.createElement('td');
	  		button = document.createElement('button');
				button.setAttribute('id',data);
		  	button.textContent = "Send Message";
	  		td.innerHTML = data;
	  		tr.appendChild(td);
	  		tr.appendChild(button);
	  		button.addEventListener('click',(e)=>{
	  			console.log(data);
	  			SendMessage(data);
  		});

  		tbodys2.appendChild(tr);
			});
  	}

  	
});
}

// Get User Team Project
async function GetUserTeamProject(team) {
	const projects = collection(db,'project');
	const q = query(projects,where("Team","==",team));
	const querySnapshot = await getDocs(q);
	querySnapshot.forEach((doc) => {
  	console.log(doc.id);
  		let tr1 = document.createElement('tr');
  		let tr2 = document.createElement('tr');
  		let td1 = document.createElement('td');
  		let button = document.createElement('button');
  		if (doc.data().isComplete == "false") {
  			button.textContent = "Not Complete";
  		}
  		else{
  			button.textContent = "Completed";
  		}
 
  		td1.innerHTML = doc.data().Description;


  		tr1.appendChild(td1);
  		tr2.appendChild(button);

  		tbodys1.appendChild(tr1);
  		tbodys1.appendChild(tr2);
});

}

//Send a message
function SendMessage(userName){
	//sessionStorage.clear();
	sessionStorage.setItem("User", userName);
}

window.onload = GetUserInfo;
</script>
</body>
</html>